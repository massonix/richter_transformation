---
title: 'Annotate tumoral cells (012 and 019)'
author: "Ramon Massoni-Badosa"
date: "2021/04/09"
output: 
  BiocStyle::html_document:
    toc: true
    toc_float: true
    number_sections: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, out.width = "100%", fig.align='center', 
                      message=FALSE, warning = FALSE)
options(width = 1200)
```


# Introduction

IMPORTANT: RUN HARMONY WITH GROUP.BY.VARS = "SUBPROJECT" AND SUBSETTING TO KEEP ONLY 00_30, ETC. FOR BCLLATLAS_10, SO THAT WE ARE STRICTLY CORRECTING TECHNICAL REPLICATES.

In previous notebooks, we clustered and annotated tumoral cells of the subproject BCLLATLAS_10 for the donors 12 and 19. Here, we will transfer this label to the cells of the subproject BCLLATLAS_29. To do so, we will leverage [Harmony](), as several benchmarking efforts have demonstrated that it's the best performing batch effect correction tool.

Importantly, integration tools can remove biological variability of interest, so we will also cluster BCLLATLAS_29 samples independently to see if the underlining biology is preserved.


# Pre-processing

## Load packages

```{r}
library(Seurat)
library(SeuratWrappers)
library(harmony)
library(tidyverse)
```


## Define parameters

```{r}
# Paths
path_to_obj <- here::here("results/R_objects/5.seurat_list_012_019_clustered.rds")
path_to_save <- here::here("results/R_objects/6.seurat_list_012_019_annotated.rds")


# Colors
color_palette <- c("black", "gray", "red", "yellow", "violet", "green4",
                   "blue", "mediumorchid2", "coral2", "blueviolet",
                   "indianred4", "deepskyblue1", "dimgray", "deeppink1",
                   "green", "lightgray", "hotpink1")


# Source functions
source(here::here("bin/utils.R"))
```


## Load data

```{r}
seurat <- readRDS(path_to_obj)
```


# Batch effect correction (Harmony)




# Save

```{r}
saveRDS(seurat_list, path_to_save)
```


# Session Information

```{r}
sessionInfo()
```
