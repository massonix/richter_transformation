---
title: 'Time-point-specific clustering'
author: "Ramon Massoni-Badosa"
date: "2021/06/07"
output: 
  BiocStyle::html_document:
    toc: true
    toc_float: true
    number_sections: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, out.width = "100%", fig.align='center', 
                      message=FALSE, warning = FALSE)
options(width = 1200)
```


# Introduction

Here, we will perform patient- and time-point-specific clustering. If we can indeed predict Richter-like cells at the early stages of the disease, then they should cluster together without having the Richter time-point present. On the other hand, if they were poor-quality cells, then they might scatter everywhere in the absence of a Richter-like cluster.


# Pre-processing

## Load packages

```{r}
library(Seurat)
library(tidyverse)
```


## Define parameters

```{r}
path_to_obj <- here::here("results/R_objects/patient_63/7.seurat_list_annotated_reprocessed.rds")


# Colors
color_palette <- c("black", "gray", "red", "yellow", "violet", "green4",
                   "blue", "mediumorchid2", "coral2", "blueviolet",
                   "indianred4", "deepskyblue1", "dimgray", "deeppink1",
                   "green", "lightgray", "hotpink1")


# Source functions
source(here::here("bin/utils.R"))
```


## Load data

```{r}
seurat_list <- readRDS(path_to_obj)
```



# Patient 12

```{r}
seurat_12 <- seurat_list$`12`
seurat_list_12 <- SplitObject(seurat_12, split.by = "time_point")
seurat_list_12 <- seurat_list_12[sort(unique(seurat_12$time_point))]
seurat_list_12 <- purrr::map(seurat_list_12, process_seurat, dims = 1:20)
umaps_time_points_12 <- purrr::map(
  seurat_list_12,
  DimPlot,
  pt.size = 0.8,
  cols = color_palette
)
umaps_time_points_12
```



# Patient 19

```{r}
seurat_19 <- seurat_list$`19`
seurat_list_19 <- SplitObject(seurat_19, split.by = "time_point")
seurat_list_19 <- seurat_list_19[sort(unique(seurat_19$time_point))]
seurat_list_19 <- purrr::map(seurat_list_19, process_seurat, dims = 1:20)
umaps_time_points_19 <- purrr::map(
  seurat_list_19,
  DimPlot,
  pt.size = 0.8,
  cols = color_palette
)
umaps_time_points_19
```


# Patient 3299

```{r}
seurat_3299 <- seurat_list$`3299`
seurat_list_3299 <- SplitObject(seurat_3299, split.by = "time_point")
seurat_list_3299 <- seurat_list_3299[sort(unique(seurat_3299$time_point))]
seurat_list_3299 <- purrr::map(seurat_list_3299, process_seurat, dims = 1:20)
umaps_time_points_3299 <- purrr::map(
  seurat_list_3299,
  DimPlot,
  pt.size = 0.8,
  cols = color_palette
)
umaps_time_points_3299
```


# Session Information

```{r}
sessionInfo()
```

